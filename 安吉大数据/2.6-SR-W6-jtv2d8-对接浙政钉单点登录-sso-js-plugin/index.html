<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        try {
            console.log('尝试SSO跳转');
            const code = `${getQueryString("code")}`;
            // const state = `${getQueryString("state")}`;
            if (getQueryString("code")) {
                let xhr = new XMLHttpRequest();
                xhr.open('POST', `${window.location.origin}/sdata/rest/sso/server/login?ssoType=zzt&token=${code}`)
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.setRequestHeader("Access-Control-Allow-Origin", "*");
                xhr.send()
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        // console.log(eval('('+xhr.responseText+')'))
                        // let data = JSON.parse(eval('('+xhr.responseText+')')?.result.tokenInfo) || {}
                        console.log(JSON.parse(xhr.responseText))
                        let data = JSON.parse(JSON.parse(xhr.responseText)?.result.tokenInfo) || {}
                        if (data?.code == "10000241") {
                            alert("权限不足，无法访问");
                            var userAgent = navigator.userAgent;
                            if (userAgent.indexOf("Firefox") != -1 || userAgent.indexOf("Chrome") != -1) {
                                window.location.href = "about:blank";
                                window.close();
                            } else {
                                window.opener = null;
                                window.open("", "_self");
                                window.close();
                            }
                        } else {
                            // window.SSO_IS_LOGIN = true;
                            window.location.href = `${window.location.origin}/applicationview/content/view?appid=47f4d3a3-824f-4416-8fce-8148701f1053&type=view&menuId=e607bee1-61f6-a698-c7c5-04219cd92fd3%233&token=${data.result}`;
                        }
                    }
                }

            } else {
                console.log('SSO参数获取出错');
            }
        } catch (error) {
            console.log(error);
            console.log("SSO跳转失败!");
        }
        //获取URL参数
        function getQueryString(name) {
            const reg = new RegExp(name + "=([^&]*)(&|$)", "i");
            const r = window.location.search.substr(1).match(reg);
            if (r != null) return r[1];
            return "";
        };
    </script>
</body>

</html>